<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="https://unpkg.com/@theholocron/starkiller/dist/fonts.min.css" />
		<link rel="stylesheet" href="https://unpkg.com/@theholocron/starkiller/dist/display.min.css" />
		<link rel="stylesheet" href="https://unpkg.com/@theholocron/starkiller/dist/box-model.min.css" />
		<title>Fledge Tools - Run an Auction</title>
	</head>
	<body class="font-family-sans-serif">
		<h1>Auction</h1>
		<div>
			<span class="font-size-4 font-weight-semibold">Links:</span>
			<a class="font-size-4" href="interest-groups.html">Interest Groups</a>
			<span class="margin-x-half">|</span>
			<span class="font-size-4">Auction</span>
		</div>
		<h3>Stats</h3>
		<h4>Auction timing: <span id="auction-stats" class="font-weight-normal"></span></h4>
		<h4>Render timing: <span id="render-stats" class="font-weight-normal"></span></h4>
		<hr />
		<div id="ad-slot-1"></div>
		<script type="module">
			import Fledge from './scripts/api/esm/index.js';
			const fledge = new Fledge('https://magniteengineering.github.io/fledge.polyfill/iframe.html', true);
			const timeStart = performance.now();

			const options = {
				seller: 'publisher.example',
				interestGroupBuyers: '*',
				decisionLogicUrl: 'https://entertaining-glitter-bowler.glitch.me/score.js',
				trustedScoringSignalsUrl: 'http://example.com/',
				additionalBids: [],
				auctionSignals: {
					size: {
						w: 300,
						h: 200,
					},
					content: [
						'news',
						'politics',
						'us',
						'election',
					],
					location: 'atf',
				},
				sellerSignals: {
					account_id: 1234,
					site_id: 1234,
					zone_id: 1234,
					size_id: 123,
				},
				perBuyerSignals: {
					'dsp.com': {
						content_quality: 230,
					},
				},
			};
			const auctionResults = await fledge.runAdAuction(options);
			const timeRender = performance.now();

			if (auctionResults) {
				await fledge.renderAd('#ad-slot-1', auctionResults, true);
			} else {
				document.getElementById('ad-slot-1').innerHTML = 'No eligible ads!';
			}

			const timeEnd = performance.now();
			const auctionTiming = `${(timeRender - timeStart)}ms`;
			const renderTiming = `${(timeEnd - timeRender)}ms`;
			document.getElementById('auction-stats').innerHTML = auctionTiming;
			document.getElementById('render-stats').innerHTML = renderTiming;
		</script>
	</body>
</html>

var fledgeframe=function(){"use strict";function e(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function t(t,n){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(n);const o=e(r);return(e,t)=>o.then((r=>t(r.transaction(n,e).objectStore(n))))}let n;function r(){return n||(n=t("keyval-store","keyval")),n}function o(t=r()){const n=[];return function(t,n){return t("readonly",(t=>(t.openCursor().onsuccess=function(){this.result&&(n(this.result),this.result.continue())},e(t.transaction))))}(t,(e=>n.push([e.key,e.value]))).then((()=>n))}const a=t("fledge.v1","interest-groups"),s=(e,t)=>`${e}-${t}`;function i(t,n){const o=s(t.owner,t.name);return function(t,n=r()){return n("readonly",(n=>e(n.get(t))))}(o,a)?function(t,n,o=r()){return o("readwrite",(r=>new Promise(((o,a)=>{r.get(t).onsuccess=function(){try{r.put(n(this.result),t),o(e(r.transaction))}catch(e){a(e)}}}))))}(o,(e=>({...e,...t,_expired:Date.now()+n})),a):function(t,n,o=r()){return o("readwrite",(r=>(r.put(n,t),e(r.transaction))))}(o,{_created:Date.now(),_expired:Date.now()+n,_updated:Date.now(),...t},a)}const c=t=>function(t,n=r()){return n("readwrite",(n=>(n.delete(t),e(n.transaction))))}(s(t.owner,t.name),a),u=e=>e.then((e=>[e,void 0])).catch((e=>Promise.resolve([void 0,e]))),l=async(e,t,...n)=>{const[r,o]=await u(import(e));if(o)return null;if(!r[t]||"function"!=typeof r[t])return null;try{return r[t](...n)}catch(e){return null}},d=async(e,t)=>{if(!e||!t)return;const n=`hostname=${window.top.location.hostname}`,[r,o]=await u(fetch(`${e}?${n}&keys=${t.join(",")}`));if(o||!r.ok||!(e=>/\bapplication\/json\b/.test(e?.headers?.get("content-type")))(r))return null;const a=await r.json(),s={};for(const e in a)t.includes(e)&&(s[e]=a[e]);return s&&0!==Object.keys(s).length&&s.constructor===Object?s:null};async function w(e){const t=(await o(a)).flatMap((([e,t])=>t)).filter((t=>"*"!==e.interestGroupBuyers?e.interestGroupBuyers.includes(t.owner):t));if(!t||!Array.isArray(t)||0===t.length)return null;const n=await Promise.all(t.map((t=>(async(e,t)=>{const n=performance.now(),r=await d(e?.trustedBiddingSignalsUrl,e?.trustedBiddingSignalsKeys),o=await l(e.biddingLogicUrl,"generateBid",e,t?.auctionSignals,t?.perBuyerSignals?.[e.owner],r,{topWindowHostname:window.top.location.hostname,seller:t.seller});if(!(o.ad&&"object"==typeof o.ad&&o.bid&&"number"==typeof o.bid&&o.render)||"string"!=typeof o.render&&!Array.isArray(o.render))return!1;const a=performance.now();return{...e,...o,duration:a-n}})(t,e))).filter((e=>e)));if(!n.length)return null;const r=await(async(e,t)=>Promise.all(e.map((async e=>{let n;e.ad&&e.ad.length>0&&(n=e?.ad?.map((({renderUrl:e})=>e)));const r=await d(t?.trustedScoringSignalsUrl,n);return{bid:e,score:await l(t.decisionLogicUrl,"scoreAd",e?.ad,e?.bid,t,r,{topWindowHostname:window.top.location.hostname,interestGroupOwner:e.owner,interestGroupName:e.name,biddingDurationMsec:e.duration})}}))))(n,e),[s]=r.filter((({score:e})=>e>0)).sort(((e,t)=>e.score>t.score?1:-1));if(!s)return null;const i=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));return sessionStorage.setItem(i,JSON.stringify({origin:`${window.top.location.origin}${window.top.location.pathname}`,timestamp:Date.now(),conf:e,winner:s})),i}async function p({data:e,ports:t}){try{if(!Array.isArray(e))throw new Error(`The API expects the data to be in the form of an array, with index 0 set to the action, and index 1 set to the data.  A ${typeof e} was passed instead.`);switch(e[0]){case"joinAdInterestGroup":{const[,t]=e,[n,r]=t;return await i(n,r),!0}case"leaveAdInterestGroup":{const[,t]=e,[n]=t;return await c(n),!0}case"runAdAuction":{const[,n]=e,[r]=n;if(1!==t.length)throw new Error(`Port transfer mismatch during request: expected 1 port, but received ${t.length}`);const[o]=t,a=[!0,await w(r)];return o.postMessage(a),o.close(),!0}default:return!1}}catch(e){const n=[!1];for(const e of t)e.postMessage(n);throw e}}return async function(){const[e]=window.location.ancestorOrigins;if(void 0===e)throw new Error("Can't call 'postMessage' on the Frame window when run as a top-level document");const{port1:t,port2:n}=new MessageChannel;t.onmessage=p,window.parent.postMessage({"fledge.polyfill":1},e,[n])}}();

var fledge=function(){"use strict";const e={seller:"string",decisionLogicUrl:"url",interestGroupBuyers:"mixed",trustedScoringSignalsUrl:"url",additionalBids:"array",auctionSignals:"object",sellerSignals:"object",perBuyerSignals:"object"},r={owner:"string",name:"string",biddingLogicUrl:"url",dailyUpdateUrl:"url",trustedBiddingSignalsUrl:"url",trustedBiddingSignalsKeys:"array",userBiddingSignals:"object",ads:"array"},t=(e,r,t)=>r.map((r=>`'${r}' requires a type of "${t[r]}"! A type of ${typeof e[r]} was provided instead.`)),o={array:e=>"undefined"!==e&&Array.isArray(e),number:e=>"undefined"!==e&&"number"==typeof e,object:e=>"undefined"!==e&&"object"==typeof e&&null!==e&&!Array.isArray(e),string:e=>"undefined"!==e&&"string"==typeof e,mixed:e=>"undefined"!==e&&(Array.isArray(e)||"string"==typeof e),url:e=>{try{return Boolean(new URL(e))}catch(e){return!1}}},n=(e,r)=>new Promise(((t,o)=>{const n=o=>{r(o)&&(e.removeEventListener("message",n),e.removeEventListener("messageerror",i),t(o))},i=t=>{r(t)&&(e.removeEventListener("message",n),e.removeEventListener("messageerror",i),o(new Error("Message deserialization error")))};e.addEventListener("message",n),e.addEventListener("messageerror",i)}));const i=async(e,r,...t)=>{const[o,n]=await(i=import(e),i.then((e=>[e,void 0])).catch((e=>Promise.resolve([void 0,e]))));var i;if(n)return null;if(!o[r]||"function"!=typeof o[r])return null;try{return o[r](...t)}catch(e){return null}},s=({source:e,target:r=document.body,props:t={},style:o={}})=>{if(!e)throw new Error("Something went wrong! No URL was found.");const n=new URL(e,document.baseURI),i=document.createElement("iframe"),s={src:n,scrolling:"no",...t},a={"border-width":0,...o};return Object.entries(s).map((([e,r])=>i.setAttribute(e,r))),Object.entries(a).map((([e,r])=>i.style.setProperty(e,r))),r.appendChild(i),{iframe:i,origin:n.origin}},a={getFramePort:async function(e,r){const{data:t,ports:o,origin:i}=await n(window,(({source:r})=>r===e.contentWindow));if(i!==r)throw new Error(`Message origins are mismatched! Expected ${r}, received ${i}`);if(1!==t["fledge.polyfill"])throw new Error(`Message versions are mismatched! Expected 1, but received ${t["fledge.polyfill"]}`);if(1!==o.length)throw new Error(`Message ports are mismatched! Expected 1 port, received ${o.length}`);return o[0]},getFromFrame:function(e){const r=n(e,(()=>!0));return e.start(),r},get:n},d=(e,r)=>{const n=Object.entries(e).filter((([e,t])=>!o[r[e]](t))).flatMap((([e])=>e));if(n.length)throw new Error(t(e,n,r).join(". "));return!1},l=(e,r)=>{const t=r.filter((r=>!e.hasOwnProperty(r)));if(t.length)throw new Error(`Required options are missing! You must provide an 'object' of options with all of the following required options: ${t.join(", ")}.`);return!1},c=(e,r)=>{if(!o[r](e))throw new Error(`Must be of type "${r}"! ${typeof e} was provided.`)},u=2592e6;return class{constructor(e){this.url=e||"http://localhost:8000/iframe.html";const{iframe:r,origin:t}=s({source:this.url,style:{display:"none"}});r.sandbox.add("allow-same-origin","allow-scripts");const o=a.getFramePort(r,t);this._props={iframe:r,port:o}}get props(){return this._props}async joinAdInterestGroup(e,t){if(c(e,"object"),c(t,"number"),l(e,["owner","name","biddingLogicUrl"]),d(e,r),t>u)throw new Error("'expiry' is set past the allowed maximum value. You must provide an expiration that is less than or equal to 2592000000.");(await this.props.port).postMessage(["joinAdInterestGroup",[e,t]])}async leaveAdInterestGroup(e){c(e,"object"),l(e,["owner","name"]),d(e,r);(await this.props.port).postMessage(["leaveAdInterestGroup",[e]])}async runAdAuction(r){c(r,"object"),l(r,["seller","decisionLogicUrl","interestGroupBuyers"]),d(r,e);const t=await this.props.port,{port1:o,port2:n}=new MessageChannel;try{t.postMessage(["runAdAuction",[r]],[n]);const{data:e}=await a.getFromFrame(o);if(!e[0])throw new Error("No response from the iframe was found!");const[,i]=e;return i}finally{o.close()}}async renderAd(e,r){c(e,"string"),c(r,"string");const t=document.querySelector(e);if(!t)throw new Error(`Target not found on the page! Please check that ${t} exists on the page.`);const{origin:o,conf:n,winner:a}=JSON.parse(sessionStorage.getItem(r));if(!a)throw new Error(`A token was not found! Token provided: ${r}`);if(o!==`${window.top.location.origin}${window.top.location.pathname}`)throw new Error("The ads origin does not match the hosts origin!  No ad was rendered.");s({source:a.bid.render,target:t,props:{id:`fledge-auction-${r}`}});if(!document.querySelector(`#fledge-auction-${r}`))throw new Error("Something went wrong! No ad was rendered.");const d=await i(n.decisionLogicUrl,"reportResult",n,{topWindowHostname:window.top.location.hostname,interestGroupOwner:a.bid.owner,interestGroupName:a.bid.name,renderUrl:a.bid.render,bid:a.bid.bid});await i(a.bid.biddingLogicUrl,"reportWin",n?.auctionSignals,n?.perBuyerSignals?.[a.bid.owner],d,{topWindowHostname:window.top.location.hostname,interestGroupOwner:a.bid.owner,interestGroupName:a.bid.name,renderUrl:a.bid.render,bid:a.bid.bid})}}}();
